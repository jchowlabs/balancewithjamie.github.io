<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Balance With Jamie</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-002J8VYT3K"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-002J8VYT3K');
  </script>
  <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
  <!-- Cloudflare Turnstile (bot protection) -->
  <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>
  <!-- First Section: Hero + Does this sound familiar -->
  <section class="section-one">
    <div class="hero">
      <div class="hero-overlay">
        <div class="hero-content">
          <h1>Finding Balance After a Lupus Diagnosis</h1>
          <p class="hero-subtitle">Lifestyle support designed for people living with lupus</p>
          <a href="https://calendly.com/balancewithjamie/30-minutes" class="cta-button">Start Your Journey</a>
        </div>
      </div>
      <div class="wave-divider">
        <svg viewBox="0 0 1440 120" preserveAspectRatio="none">
          <path d="M0,0 C480,100 960,100 1440,0 L1440,120 L0,120 Z" fill="#f5f3f0"/>
        </svg>
      </div>
    </div>
    
    <div class="familiar">
      <h2>Does this sound familiar?</h2>
      <div class="familiar-grid">
        <div class="familiar-item" data-order="1">
          <div class="icon"><img src="static/bullet1.png" alt=""></div>
          <p>You look "fine" on the outside, but inside you're managing pain, fatigue, and brain fog.</p>
        </div>
        <div class="familiar-item" data-order="3">
          <div class="icon"><img src="static/bullet2.png" alt=""></div>
          <p>Your symptoms make even the simplest tasks feel difficult and exhausting.</p>
        </div>
        <div class="familiar-item" data-order="5">
          <div class="icon"><img src="static/bullet3.png" alt=""></div>
          <p>You're overwhelmed by conflicting advice and unsure what works for your body.</p>
        </div>
        <div class="familiar-item" data-order="2">
          <div class="icon"><img src="static/bullet4.png" alt=""></div>
          <p>You want to feel more balanced, calm, and at ease in your daily life.</p>
        </div>
        <div class="familiar-item" data-order="4">
          <div class="icon"><img src="static/bullet5.png" alt=""></div>
          <p>You want guidance that's personalized and realistic for you.</p>
        </div>
        <div class="familiar-item" data-order="6">
          <div class="icon"><img src="static/bullet6.png" alt=""></div>
          <p>You want to be heard and supported by someone who truly understands.</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Second Section: Jamie + Guide + Help -->
  <section class="section-two">
    <div class="jamie">
      <div class="jamie-content">
        <div class="jamie-image">
          <img src="static/profile.jpeg" alt="Jamie">
        </div>
        <div class="jamie-text">
          <h2>Hi, I'm Jamie.</h2>
          <p>I'm a registered nurse and board-certified health & wellness coach living with lupus too.</p>
          <p>I take a lifestyle-based approach that complements your medical care, helping you find balance and manage your symptoms through everyday habits - from how you eat and rest, to how you move and care for your well-being.</p>
        </div>
      </div>
    </div>
    <div class="wave-divider-jamie">
      <svg viewBox="0 0 1440 120" preserveAspectRatio="none">
        <path d="M0,0 C480,100 960,100 1440,0 L1440,120 L0,120 Z" fill="#fff"/>
      </svg>
    </div>

    <div class="guide">
      <div class="guide-content">
        <div class="guide-text">
          <h2>Grab Your Free Guide</h2>
          <p class="guide-subtitle">Discover how simple food choices and daily habits can support your body and overall well-being.</p>
          <div class="guide-form">
            <button type="button" class="guide-button" id="open-guide-modal">Download Now</button>
          </div>
        </div>
        <div class="guide-image-container">
          <img src="static/freebie.png" alt="Free Guide" class="guide-image">
        </div>
      </div>
    </div>
    <div class="wave-divider-guide">
      <svg viewBox="0 0 1440 120" preserveAspectRatio="none">
        <path d="M0,0 C480,100 960,100 1440,0 L1440,120 L0,120 Z" fill="#f5f3f0"/>
      </svg>
    </div>

    <div class="help">
      <h2>How I Can Help</h2>
      <div class="help-grid">
        <div class="help-left">
          <p>Support looks different for everyone with lupus.</p>
          <p>Some people need a <em>single conversation</em> to get clarity and feel grounded again.</p>
          <p>Others benefit from <em>ongoing guidance</em> as they navigate flares or life changes.</p>
        </div>
        <div class="help-right">
          <p class="help-intro">During this introductory call, we'll take time to:</p>
          <ul>
            <li>Discuss your current challenges</li>
            <li>Identify your goals and what matters most</li>
            <li>Explore what support feels right for you</li>
          </ul>
          <a href="https://calendly.com/balancewithjamie/30-minutes" class="chat-btn">Let's Chat</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Free Guide Modal -->
  <div class="modal" id="free-guide-modal" aria-hidden="true">
    <div class="modal__overlay" data-modal-close></div>
    <div class="modal__dialog" role="dialog" aria-modal="true" aria-labelledby="free-guide-modal-title">
      <button class="modal__close" type="button" aria-label="Close" data-modal-close>&times;</button>
      <h3 class="modal__title" id="free-guide-modal-title">Free Guide</h3>
      <form class="modal__form" id="free-guide-modal-form" novalidate>
        <input type="email" id="free_guide_email" name="user_email" class="modal__input" placeholder="Email Address" autocomplete="email">
        <div class="modal__field-error" id="free-guide-email-error" aria-live="polite"></div>

        <div class="modal__turnstile" aria-label="Security check">
          <div id="cf-turnstile"></div>
        </div>

        <div class="modal__response" id="free-guide-modal-response" aria-live="polite"></div>
        <button type="submit" class="modal__button" id="free-guide-submit-btn">Download Now</button>
      </form>
    </div>
  </div>

  <script>
    // EmailJS functionality
    (function() {
      emailjs.init("CklLL1WUpc6TzPzeO");

      // Cloudflare Turnstile (client-side gating only; real protection requires server-side verification)
      const TURNSTILE_SITEKEY = '0x4AAAAAAACOP_zPQA-6E3XzY';
      let turnstileWidgetId = null;
      let turnstileToken = '';

      const openBtn = document.getElementById('open-guide-modal');
      const modal = document.getElementById('free-guide-modal');
      const modalForm = document.getElementById('free-guide-modal-form');
      const emailInput = document.getElementById('free_guide_email');
      const emailErrorEl = document.getElementById('free-guide-email-error');
      const responseEl = document.getElementById('free-guide-modal-response');
      const submitBtn = document.getElementById('free-guide-submit-btn');
      const turnstileContainer = document.getElementById('cf-turnstile');

      if (!openBtn || !modal || !modalForm || !emailInput || !submitBtn) {
        return;
      }

      const setResponse = (message, kind) => {
        if (!responseEl) return;
        responseEl.textContent = message || '';
        responseEl.dataset.kind = kind || '';
      };

      const setEmailError = (message) => {
        if (!emailErrorEl) return;
        emailErrorEl.textContent = message || '';
      };

      const isValidEmail = (value) => {
        const v = (value || '').trim();
        // Pragmatic email check: good UX without native tooltips.
        return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(v);
      };

      const renderTurnstile = () => {
        if (!turnstileContainer) return;
        if (turnstileWidgetId !== null) return;

        if (!window.turnstile || typeof window.turnstile.render !== 'function') {
          // Script may still be loading.
          return;
        }

        // Ensure container is empty before rendering.
        turnstileContainer.innerHTML = '';

        turnstileWidgetId = window.turnstile.render(turnstileContainer, {
          sitekey: TURNSTILE_SITEKEY,
          callback: function(token) {
            turnstileToken = token || '';
            if (turnstileToken) setResponse('', '');
          },
          'expired-callback': function() {
            turnstileToken = '';
          },
          'error-callback': function() {
            turnstileToken = '';
            setResponse('Security check failed to load. Please try again.', 'error');
          },
        });
      };

      const ensureTurnstileRendered = () => {
        // Prefer Turnstile's readiness hook when available.
        if (window.turnstile && typeof window.turnstile.ready === 'function') {
          window.turnstile.ready(() => {
            renderTurnstile();
          });
        }

        // Render immediately if possible; otherwise retry for a bit longer.
        renderTurnstile();
        if (turnstileWidgetId !== null) return;

        let tries = 0;
        const maxTries = 100; // ~10s
        const timer = setInterval(() => {
          tries += 1;
          renderTurnstile();
          if (turnstileWidgetId !== null) {
            clearInterval(timer);
            return;
          }
          if (tries >= maxTries) {
            clearInterval(timer);
            setResponse('Security check did not load. Please disable any ad blockers/privacy extensions and refresh.', 'error');
          }
        }, 100);
      };

      const resetTurnstile = () => {
        turnstileToken = '';
        try {
          if (window.turnstile && typeof window.turnstile.reset === 'function' && turnstileWidgetId !== null) {
            window.turnstile.reset(turnstileWidgetId);
          }
        } catch (e) {
          // ignore
        }
      };

      const openModal = () => {
        modal.classList.add('is-open');
        modal.setAttribute('aria-hidden', 'false');
        document.body.classList.add('modal-open');
        setResponse('', '');
        setEmailError('');
        ensureTurnstileRendered();
        emailInput.focus();
      };

      const closeModal = () => {
        modal.classList.remove('is-open');
        modal.setAttribute('aria-hidden', 'true');
        document.body.classList.remove('modal-open');
        modalForm.reset();
        setResponse('', '');
        setEmailError('');
        resetTurnstile();
      };

      openBtn.addEventListener('click', openModal);

      modal.addEventListener('click', function(e) {
        const target = e.target;
        if (target && target.closest && target.closest('[data-modal-close]')) {
          closeModal();
        }
      });

      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && modal.classList.contains('is-open')) {
          closeModal();
        }
      });

      emailInput.addEventListener('input', function() {
        setEmailError('');
      });

      modalForm.addEventListener('submit', function(event) {
        event.preventDefault();

        const originalBtnText = submitBtn.textContent;
        const emailValue = (emailInput.value || '').trim();

        if (!isValidEmail(emailValue)) {
          setEmailError('Please enter valid email.');
          emailInput.focus();
          return;
        }

        if (!turnstileToken) {
          setResponse('Please complete the security check.', 'error');
          return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Sending...';
        setResponse('', '');

        const templateParams = {
          to_email: emailValue,
          turnstile_token: turnstileToken,
        };

        emailjs.send("service_85kpvne", "template_pgz6itn", templateParams)
          .then(function() {
            submitBtn.textContent = 'Sent!';
            setResponse('Check your inbox for the guide.', 'success');

            setTimeout(function() {
              submitBtn.disabled = false;
              submitBtn.textContent = originalBtnText;
              closeModal();
            }, 2000);
          })
          .catch(function(error) {
            console.error("EmailJS error:", error);
            setResponse('Something went wrong. Please try again.', 'error');
            submitBtn.disabled = false;
            submitBtn.textContent = originalBtnText;
          });
      });
    })();
  </script>
</body>
</html>
